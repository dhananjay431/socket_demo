

<html>
<head>
  <style>
  #map_canvas{
  background: #fafafa;
  width: 100%;
  height: 400px;
}

.custom-marker{
  margin: -10px 0 0 -10px;
  transition: all ease .5s;
  &:before{
    display: block;
    position: relative;
    content: '';
    width: 20px;
    height: 20px;
    background: #bada55;
    border: 2px solid #fff;
    border-radius: 50%;
    z-index: 2;
    box-shadow: 0 2px 2px rgba(0,0,0,.2);
  }
  .custom-marker-inner{
    position: absolute;
    bottom: 36px;
    left: -15px;
    z-index: 3;
    &:before{
      content: '';
      display: block;
      width: 50px;
      height: 50px;
      background: #fff;
      border-radius: 50% 50% 0 50%;
      box-shadow: 1px 1px 2px rgba(0,0,0,.2);
      transform: rotate(45deg);
    }
    .custom-marker-avatar{
      content: '';
      display: block;
      width: 44px;
      height: 44px;
      line-height: 44px;
      font-weight: 600;
      font-size: 12px;
      background-size: cover;
      border-radius: 50%;
      position: absolute;
      top: 3px;
      left: 3px;
    } 
  }
}

</style>
  <script src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false&libraries=geometry"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gmaps.js/0.4.25/gmaps.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js"></script>
<script>
$(function(){
  var socket,socketCnt=0,socketData=
  [[18.47988,73.80436],[18.48535,73.79844],[18.49108,73.79021],[18.49351,73.78828],[18.495510000000003,73.78777000000001],[18.49831,73.78914],[18.5014,73.79177],[18.503860000000003,73.79249],[18.506300000000003,73.79139],[18.507440000000003,73.78818000000001],[18.507350000000002,73.78321000000001],[18.50899,73.77528000000001],[18.511400000000002,73.77143000000001],[18.5135,73.76979],[18.516650000000002,73.76884000000001],[18.52165,73.76952],[18.525730000000003,73.77266],[18.52774,73.777],[18.52993,73.77882000000001],[18.535020000000003,73.78044000000001],[18.538300000000003,73.78112],[18.539350000000002,73.78078000000001],[18.54221,73.77730000000001],[18.546480000000003,73.77383],[18.557380000000002,73.76996000000001],[18.571930000000002,73.76464],[18.59494,73.75605],[18.643720000000002,73.73709000000001],[18.667440000000003,73.72751000000001],[18.675780000000003,73.72447000000001],[18.677680000000002,73.72380000000001],[18.67866,73.72453],[18.6794,73.72546000000001],[18.680770000000003,73.72849000000001],[18.68167,73.73073000000001],[18.6794,73.73243000000001],[18.678220000000003,73.73535000000001],[18.678810000000002,73.74015],[18.679910000000003,73.74241],[18.6825,73.74451],[18.685270000000003,73.74714],[18.68851,73.74860000000001],[18.69562,73.75489],[18.698420000000002,73.75748],[18.6992,73.75880000000001],[18.70174,73.75987],[18.708360000000003,73.76056000000001],[18.71153,73.76104000000001],[18.71311,73.76274000000001],[18.714170000000003,73.76449000000001],[18.71499,73.76419],[18.71986,73.76229000000001],[18.7221,73.76217000000001],[18.72437,73.76119],[18.73186,73.75818000000001],[18.73419,73.75733000000001],[18.736150000000002,73.75651],[18.739150000000002,73.75518000000001],[18.73948,73.75655],[18.74011,73.75957000000001],[18.740530000000003,73.76154000000001],[18.740660000000002,73.76179],[18.741690000000002,73.76241],[18.74219,73.76784],[18.74257,73.77292],[18.742350000000002,73.77424],[18.74353,73.77533000000001],[18.74546,73.7762],[18.74678,73.77648],[18.749640000000003,73.77715],[18.754450000000002,73.77672000000001],[18.755930000000003,73.77593],[18.760820000000002,73.77590000000001],[18.76544,73.77470000000001],[18.776670000000003,73.77582000000001],[18.784750000000003,73.77707000000001],[18.785880000000002,73.7771],[18.787270000000003,73.77604000000001],[18.78693,73.77774000000001],[18.78696,73.7788],[18.78772,73.78095],[18.788890000000002,73.78442000000001],[18.79041,73.7925],[18.79175,73.79544],[18.791420000000002,73.7971],[18.79097,73.80093000000001],[18.790390000000002,73.80468],[18.79213,73.80531],[18.79795,73.80749],[18.80293,73.80796000000001],[18.803980000000003,73.80915],[18.809240000000003,73.80701],[18.81295,73.80507],[18.816180000000003,73.80455],[18.820790000000002,73.80322000000001],[18.824430000000003,73.80351],[18.82871,73.80479000000001],[18.832970000000003,73.80581000000001],[18.83905,73.80583],[18.843680000000003,73.80602],[18.84618,73.80551000000001],[18.84804,73.8053],[18.849600000000002,73.80526],[18.8502,73.80426],[18.850820000000002,73.80358000000001],[18.851290000000002,73.80433000000001],[18.85229,73.80591000000001],[18.853080000000002,73.80667000000001],[18.855140000000002,73.80915],[18.85931,73.81201],[18.86336,73.81404],[18.869120000000002,73.81678000000001],[18.875680000000003,73.81928],[18.874570000000002,73.82215000000001],[18.87496,73.82402],[18.876430000000003,73.82685000000001],[18.877370000000003,73.82877],[18.88125,73.83361000000001],[18.88165,73.83451000000001],[18.883100000000002,73.8369],[18.883090000000003,73.83814000000001],[18.881690000000003,73.84142],[18.880010000000002,73.84436000000001],[18.87742,73.84993],[18.876160000000002,73.85089],[18.87471,73.85055000000001],[18.87376,73.85152000000001],[18.8718,73.8538],[18.867880000000003,73.85662],[18.86447,73.85871],[18.86296,73.86112],[18.86204,73.86134000000001],[18.861600000000003,73.86295000000001],[18.85688,73.86766],[18.854570000000002,73.87071],[18.852990000000002,73.87103],[18.85087,73.87392000000001],[18.850330000000003,73.87644],[18.84878,73.88269000000001],[18.8469,73.88271],[18.846110000000003,73.8827],[18.847250000000003,73.88403000000001],[18.850730000000002,73.88754],[18.853620000000003,73.88774000000001],[18.8563,73.88761000000001],[18.861610000000002,73.89129000000001],[18.86942,73.89659],[18.87865,73.90006000000001],[18.889490000000002,73.90539000000001],[18.89241,73.90744000000001],[18.895000000000003,73.90632000000001],[18.89637,73.90519],[18.89889,73.90672],[18.901020000000003,73.90702],[18.900840000000002,73.90793000000001],[18.90161,73.90861000000001],[18.90209,73.90977000000001],[18.90023,73.90997],[18.89983,73.91101],[18.90049,73.91274],[18.90285,73.91463],[18.90791,73.91606],[18.91861,73.9193],[18.92358,73.92132000000001],[18.92699,73.92526000000001],[18.93336,73.93104000000001],[18.93699,73.93576],[18.94163,73.94011],[18.943890000000003,73.94114],[18.947550000000003,73.94103000000001],[18.9539,73.93997],[18.95933,73.94156000000001],[18.96197,73.94206000000001],[18.966900000000003,73.94473],[18.971680000000003,73.94519000000001],[18.977690000000003,73.94653000000001],[18.98208,73.9453],[18.990250000000003,73.94277000000001],[18.99811,73.9431],[19.004170000000002,73.94647],[19.007160000000002,73.94812],[19.0119,73.94902],[19.017580000000002,73.94904000000001],[19.03462,73.95472000000001],[19.040360000000003,73.95547],[19.042430000000003,73.95668],[19.0438,73.95632],[19.04577,73.95582],[19.05186,73.95697000000001],[19.070990000000002,73.96304],[19.097,73.97080000000001],[19.11445,73.97304000000001],[19.12215,73.97547],[19.124750000000002,73.97969],[19.12931,73.9881],[19.13232,73.99764],[19.13623,74.00816],[19.13964,74.02017000000001],[19.1503,74.03445],[19.155890000000003,74.04194000000001],[19.16103,74.05445],[19.161640000000002,74.05954000000001],[19.1631,74.06371],[19.16757,74.07123],[19.17415,74.07943],[19.184410000000003,74.09828],[19.191300000000002,74.10482],[19.19912,74.11247],[19.206970000000002,74.11963],[19.2146,74.12475],[19.2203,74.12531000000001],[19.22896,74.12795000000001],[19.23608,74.13301000000001],[19.242040000000003,74.13584],[19.246000000000002,74.13783000000001],[19.248630000000002,74.14051],[19.25121,74.14154],[19.255020000000002,74.14112],[19.258210000000002,74.14133000000001],[19.26098,74.14322],[19.264780000000002,74.1481],[19.27214,74.15025],[19.27994,74.15469],[19.28357,74.15749000000001],[19.2862,74.15855],[19.2908,74.16484000000001],[19.293850000000003,74.16935000000001],[19.29728,74.17014],[19.303420000000003,74.17112],[19.316550000000003,74.17449],[19.32048,74.17832],[19.32381,74.18302],[19.327550000000002,74.19164],[19.33032,74.19486],[19.338520000000003,74.20168000000001],[19.344510000000003,74.20448],[19.346690000000002,74.20491000000001],[19.34767,74.20679000000001],[19.349230000000002,74.20883],[19.35066,74.20927],[19.353260000000002,74.21333],[19.354770000000002,74.21312],[19.358120000000003,74.21096],[19.36271,74.20695],[19.36662,74.2039],[19.37057,74.20435],[19.3773,74.20574],[19.38109,74.20748],[19.388250000000003,74.21058000000001],[19.39206,74.21245],[19.39505,74.21251000000001],[19.40005,74.21214],[19.41609,74.2078],[19.423900000000003,74.20605],[19.42999,74.20097000000001],[19.43703,74.19567],[19.43937,74.19328],[19.440240000000003,74.19098000000001],[19.440450000000002,74.18649],[19.44163,74.18573],[19.443230000000003,74.18719],[19.4451,74.19332],[19.446330000000003,74.19579],[19.449430000000003,74.19779000000001],[19.45119,74.1988],[19.454310000000003,74.19852],[19.4569,74.20048000000001],[19.459200000000003,74.20417],[19.464560000000002,74.20744],[19.46959,74.20638000000001],[19.47438,74.20381],[19.47857,74.20042000000001],[19.48833,74.19810000000001],[19.493530000000003,74.19811],[19.52597,74.20286],[19.53327,74.20373000000001],[19.54032,74.20389],[19.54511,74.20044],[19.54972,74.19789],[19.551340000000003,74.19963],[19.55495,74.20319],[19.555600000000002,74.20615000000001],[19.555770000000003,74.20777000000001],[19.55712,74.20823],[19.55781,74.20854],[19.55865,74.21155],[19.56268,74.21196],[19.565790000000003,74.21264000000001],[19.56745,74.21238000000001],[19.569490000000002,74.21148000000001],[19.569650000000003,74.20986],[19.57,74.20840000000001],[19.571450000000002,74.20786000000001],[19.573420000000002,74.2076],[19.57695,74.20646],[19.577080000000002,74.20796]];



  function liveTrack(map, mark, icons, coords,speed,delay) {
        var target = 0;
        function _goToPoint() {
          if(target > coords.length)
            return ;
            // dmap.speed = km_h;
            var lat = mark.latlng.lat;
            var lng = mark.latlng.lng;
            var step = (speed * 1000 * delay) / 3600000; // in meters
            if(coords[target] == undefined)
              return;
            var dest = new google.maps.LatLng(coords[target].lat, coords[target].lng);   
            var dest2 = new google.maps.LatLng(mark.latlng.lat, mark.latlng.lng);
            var distance = google.maps.geometry.spherical.computeDistanceBetween(dest, dest2); // in meters
            var numStep = distance / step;
            var i = 0;
            var deltaLat = (coords[target].lat - lat) / numStep;
            var deltaLng = (coords[target].lng - lng) / numStep;
            function _moveMarker () {
                lat += deltaLat;
                lng += deltaLng;
                i += step;
                if (i < distance) {
                    var head = google.maps.geometry.spherical.computeHeading(mark.getPosition(), new google.maps.LatLng(lat, lng))
                    if ((head != 0) || (head == NaN)) {
                        icons.rotation = head
                    }
                    marker1.draw(head);
                   // mark.setIcon(icons);
                   // mark.setPosition(new google.maps.LatLng(lat, lng));
                    setTimeout(_moveMarker,delay);
                }
                else {
                    var head = google.maps.geometry.spherical.computeHeading(mark.getPosition(), new google.maps.LatLng(lat, lng));
                    if ((head != 0) || (head == NaN)) {
                        icons.rotation = head
                    }
                     marker1.draw(head);
                    //mark.setIcon(icons);
                    //mark.setPosition(dest);
                    target++;
                    setTimeout(_goToPoint,delay);
                }
            }
            _moveMarker();
        }
        _goToPoint();
    }

  CustomMarker = function(latlng, map, args) {
  this.latlng = latlng;
  this.args = args;
  this.setMap(map);
}

CustomMarker.prototype = new google.maps.OverlayView();

CustomMarker.prototype.onAdd = function() {
  var self = this;
  var div = this.div;
  if (!div) {
    // Generate marker html
    div = this.div = document.createElement('img');
    div.className = 'custom-marker';
    div.src= "D:/socket_demo/socket_connection/top-car-view-png-34864.png";
    div.style.height="40px";
    div.style.width="20px";
    div.style.position = 'absolute';
    var innerDiv = document.createElement('div');
    innerDiv.className = 'custom-marker-inner';
    div.appendChild(innerDiv);
    if (typeof(self.args.marker_id) !== 'undefined') {
      div.dataset.marker_id = self.args.marker_id;
    }

    google.maps.event.addDomListener(div, "click", function(event) {
     alert('hii');
    });

    var panes = this.getPanes();
    panes.overlayImage.appendChild(div);
  }
}; 

CustomMarker.prototype.draw = function(rot) {
  if (this.div) {
    let position = new google.maps.LatLng(this.latlng.lat, this.latlng.lng);
    var pos = this.getProjection().fromLatLngToDivPixel(position);
    this.div.style.left = pos.x + 'px';
    this.div.style.top = pos.y + 'px';
    this.div.style.transform='rotate(' + rot + 'deg)';
  }
};
//$('#a61535002622628 img').css({transform :'rotate(' +Math.floor(Math.random() * 360) + 'deg)'})

CustomMarker.prototype.getPosition = function() {
  return this.latlng;
};


var myLatlng = new google.maps.LatLng(18.47988,73.80436);
var map = new google.maps.Map(document.getElementById("map"), {
  zoom: 10,
  center: myLatlng,
  streetViewControl: false,
  fullscreenControl: false
});




var marker1 = new CustomMarker(
  myLatlng,
  map,
  {}
);

// Init position changes
var positions = [{lat: -34.397, lng: 150.644},{lat: -34.42, lng: 150.69},{lat: -34.31, lng: 150.68},{lat: -34.34, lng: 150.69}];

marker1.latlng = {lat: -34.397, lng: 150.644};



  setInterval(function(){
    //map, mark, icons, coords,speed,delay
 
  
    marker1.latlng =  {lat: socketData[socketCnt][0], lng:socketData[socketCnt][1]};

     // console.log(socketCnt,{lat: socketData[socketCnt][0], lng:socketData[socketCnt][1]});
      var h= google.maps.geometry.spherical.computeHeading(new google.maps.LatLng(socketData[socketCnt][0],socketData[socketCnt][1]),new google.maps.LatLng(socketData[socketCnt+1][0],socketData[socketCnt+1][1]))
   //   marker1.draw(Math.floor(Math.random() * 360));
   console.log(h);
    marker1.draw(h);
      socketCnt+=1;
    //liveTrack(map,marker1,0,latLng,100,10)
  
  },1000)

// setInterval(function(){
//   console.log('timeout');
//   marker1.latlng = positions[Math.floor(Math.random() * (3 - 0 + 1)) + 0];
//   marker1.draw(Math.floor(Math.random() * 360));
// }, 600);



})

google.maps.geometry.spherical.computeHeading({lat: -34.397, lng: 150.644},{lat: -34.42, lng: 150.69})
</script> 
</head>
<body>
   <a href="#" id="show" class="btn small">start</a>
          <!--  -->

  <div id="map" style="width:100%;height:400px"></div>
<!-- <ul id="instructions">
          </ul> -->
</body>
</html>



<!-- 
setInterval(function(){
$('#5b7c173287e2af32ab4aab58  img').css({transform :'rotate(' + Math.floor(Math.random() * 360) + 'deg)'})
$('#5b62b5cd50e0545862272337  img').css({transform :'rotate(' + Math.floor(Math.random() * 360) + 'deg)'})  
},500);

setInterval(function(){
var a =  Math.floor(Math.random() * 360);
var b =  Math.floor(Math.random() * 360);
console.log(a,"-",b);
$('#a61535002622628 img').css({transform :'rotate(' +Math.floor(Math.random() * 360) + 'deg)'})
$('#5b62b5cd50e0545862272337 img').css({transform :'rotate(' + b + 'deg)'})  
},500);



 -->

