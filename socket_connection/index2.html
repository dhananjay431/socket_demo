

<html>
<head>
	<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="https://maps.google.com/maps/api/js?sensor=true"></script>
<script src="node_modules/dbel431-dmap/js/dmaps.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
<script>
$(function(){
	// var _io =io.connect('https://www.oneqlik.in/gps',
	//  {
 //      secure: true, 
 //      rejectUnauthorized: false, 
 //      transports: [
 //      	 "polling"
 //      	], 
 //      upgrade: true
 //    });
 var _io  = io.connect('https://www.oneqlik.in/gps', {
      secure: true, rejectUnauthorized: false, transports: ["websocket", "polling"], upgrade: false
    });
        _io.on('connect', function(data){
   			 console.log('Ignition IO Connected');

  	});
       var   car = 'M17.402,0H5.643C2.526,0,0,3.467,0,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759c3.116,0,5.644-2.527,5.644-5.644 V6.584C23.044,3.467,20.518,0,17.402,0z M22.057,14.188v11.665l-2.729,0.351v-4.806L22.057,14.188z M20.625,10.773 c-1.016,3.9-2.219,8.51-2.219,8.51H4.638l-2.222-8.51C2.417,10.773,11.3,7.755,20.625,10.773z M3.748,21.713v4.492l-2.73-0.349 V14.502L3.748,21.713z M1.018,37.938V27.579l2.73,0.343v8.196L1.018,37.938z M2.575,40.882l2.218-3.336h13.771l2.219,3.336H2.575z M19.328,35.805v-7.872l2.729-0.355v10.048L19.328,35.805z';
 // car = 'https://png.icons8.com/dusk/2x/car.png';
  var carIcon = {
   path: car ,
   scale: .6,
   strokeColor: 'white',
   strokeWeight: .10,
   fillOpacity: 1,
   fillColor: 'blue',
   //fillColor: '#b75656',
   offset: '5%',
   // rotation: parseInt(heading[i]),
   anchor: new google.maps.Point(10, 25), // orig 10,50 back of car, 10,0 front of car, 10,25 center of car,
   rotation: 90
 };

 var icons = {
   "car": carIcon
 }

    var dataMap={};
    var map;
  	var data = [
    		"358735072106197","358899053313154","007360065823","352887075715304","123456789012345","352094087711849","8151022475","353701091609913","352094087016595","792398348329","007360060179","007070197898","00000000","868003030350651","12312312","222","221100","868003030359389","868003030359041","868003030358951","866968030817945","868003030360056","865205032022039","866968030825369","866968030815261","866968030731278","868003030352608","358739052157675","007455036378","7862201110","78602119200","111222111211","1112211111111","002699453","22222111818111","009168695191","qw123", "qwe1234", "DSSAd", "motor112", "Ankit808", "fan123", "bulb123", "mobile123", "tube123", "tube12321", "lap123", "101", "Bulb101", "Nfnf", "qlik123", "123", "Q123", "Qlik123", "bulb121", "Fan121", "Tube1", "666666666666", "999999999999", "865205032299264", "865205031663007", "865205032256181", "352887076587769", "205032191206", "865205032259342", "865205032245010", "865205032326380", "865205032326414", "865205032244393", "865205032244435", "865205032245846", "865205032246315", "865205032244799", "865205032244526", "865205032326802", "865205032323833", "637052205721", "865205032326828", "865205032326547", "865205032325861", "865205032326679", "865205032326349", "865205032326463", "865205032323858", "865205032326588", "865205032327792", "865205032326299", "865205032326695", "865205032325937", "865205032325952", "865205032324625", "865205032326851", "865205032323825", "865205032324633", "865205032324880", "865205032246125", "865205032324831", "865205032244260", "2132323213", "865205032244708", "865205032244575", "865205032323718", "865205032324674", "865205032326745", "865205032325820", "865205032325978", "865205032244625", "865205032326752", "352887075446314", "865205032326687", "865205032326919", "123456789098765", "865205032325929", "865205032326836", "865205032323783", "865205032326190", "865205032326729", "865205032326778", "2345678901", "865205032325960", "865205032326497", "865205032325945", "865205032326943", "865205032326703", "865205032326000", "865205032323700", "865205032324849", "865205032324179", "865205032324187", "IMEI1: 867466028445646", "865205032298910", "865205032326265", "865205032022070", "865205032022609", "865205032326620", "351608084148365", "353701090180213", "865205032244609", "865205032245762", "358735072106197", "865205032326737", "865205032324807", "865205032323874", "352887076247778", "436634", "534646", "865205032088352", "858484", "865205032087990", "865205032326711", "865205032326257", "865205032324815", "865205032022294", "865205032324609", "352887075083216", "358899053313154", "865205032087362", "865205032246323", "865205032442237", "359668059931841", "359668059931783", "358511023307733", "865205032457227", "865205032326844", "865205032142548", "865205032022278", "352887077638967", "352887077242190", "352887075084016", "355227045517091", "358511023331741", "865205032087719", "868003030436492", "865205032144619", "865205032022534", "Gjo1fu8538", "999999999998", "066666666669", "352887074980644", "352887077639957", "868003030434661", "352887078178817", "865205032087867", "352887076178817", "865205032021379", "865205032022518", "087075446314", "865205032022195", "865205032087727", "865205032088444", "865205032087925", "865205032087955", "868003030440684", "868003030434430", "865205032086455", "865205032087172", "8901020108023", "865205032022302", "861359033769819", "8151022512", "865205032326968", "865205032086711", "865205032324088", "865205032139460", "866968030727250", "866968030736699", "866968030733837", "866968030727227", "866968030732573", "866968030729892", "866968030726104", "866968030734397", "866968030729199", "866968030734991", "866968030724687", "866968030731443", "866968030736129", "866968030729413", "866968030730700", "866968030735592", "866968030737614", "866968030725957", "866968030729181", "866968030734702", "866968030725882", "866968030736905", "865205032087693", "865205032147612", "865205032086752", "868003030441336", "007360065823", "865205032022146", "865205032022393", "357367031043757", "352887076604994", "0181660410103064", "355488020905614", "358511022084457", "352094087762628", "352094087762719", "352887075715304", "352887075697718", "123456789012345", "861359030602971", "352887074964986", "352094087711849", "865205032087701", "868003030478460", "590830953", "03490838", "865205032086653", "8151022475", "866968030055561", "355710099112398", "866968030730569", "862631034249564", "352887074978762", "031034249564", "358511022116812", "22014215", "111111111", "00000000000", "865205031778672", "865205032086695", "868003030048578", "170217542", "358511021688456", "868003030059013", "865205032022583", "358511022118313", "865205032021460", "866968030813555", "865205032087636", "353701091609913", "868003030473511", "865205032246133", "865205032245556", "865205032244971", "865205032088311", "868003030474972", "866968030817820", "866968030815758", "866968030812219", "866968030815485", "866968030815030", "866968030811013", "866968030813308", "866968030731088", "866968030731294", "866968030735477", "866968030816756", "866968030817978", "866968030814132", "866968030818075", "866968030812672", "352094086490395", "866968030811062", "868003030208487", "868003030217470", "868003030064567", "868003030052406", "868003030209832", "868003030208149", "868003030209469", "868003030072883", "868003030198498", "866968030812631", "866968030812482", "866968030813738", "866968030817655", "866968030812565", "866968030816814", "868003030204536", "868003030060961", "868003030209725", "868003030053933", "868003030062462", "866968030815402", "868003030207596", "868003030061084", "866968030817192", "868003030205087", "866968030813381", "868003030359215", "866968030729256", "866968030735337", "866968030725007", "866968030725502", "866968030730437", "866968030734819", "866968030732706", "866968030732698", "866968030735139", "866968030724752", "866968030736988", "866968030727714", "866968030731609", "866968030724539", "866968030732540", "866968030729462", "866968030723960", "866968030862966", "866968030863089", "358511023368743", "866968030735790", "866968030726336", "866968030734553", "868003030054394", "866968030810601", "8669680308122573", "868003030060128", "868003030200229", "868003030067099", "868003030215920", "866968030724737", "866968030727623", "865205032139056", "868003030216647", "868003030356419", "868003030356823", "868003030352178", "868003030353713", "865205032086513", "866968030824172", "866968030815444", "352094089144718", "866968030810585", "866968030817739", "866968030813373", "868003030193572", "868003030206218", "868003030359710", "868003030203892", "868003030219047", "868003030358548", "352094087016595", "352887075724041", "866968030813670", "868003030609585", "792398348329", "007360060179", "180323889", "865205030032220", "007070197898", "866968030824248", "865205032323692", "866968030823323", "352887075033369", "00000000", "868003030350651", "868003030610609", "868003030608306", "868003030610955", "12312312", "358511022219723", "868003030359173", "865205032326794", "868003030350867", "868003030357185", "4534098000", "8383883773838", "222","221100", "868003030356179", "3210563", "2039132", "868003030359819", "865205032324740", "868003030359389", "868003030359041", "868003030358951", "21321412334", "321323213", "866968030817945", "11112121", "121", "868003030062389", "868003030360056", "3213213124", "qlik123112", "qlik1231231", "865205032022039", "352887074978010", "866968030825369", "866968030815261", "358735070131304", "866968030731278", "355227044604957", "868003030352608", "1212", "121324", "31241324324", "432423423", "352887074866181", "352887074850169"];

  	for(var i=0;i<data.length;i++)
  	{
	     _io.emit('acc',data[i]);
	     _io.on(data[i]+'acc',(d1,d2,d3,d4,d5)=>{
	     	

        if((d4 != undefined) &&  (d4.last_location != undefined) && (d4.sec_last_location != undefined)){
        	//
      
        var key =d4._id;
        dataMap[key].dmap = dmap;
          	if(dataMap[key] && dataMap[key].mark)
        		console.log("if");//dataMap[key].mark.setMap(null);
        	else
        	{
        		var latLng = {lat:d4.last_location.lat,lng:d4.last_location.long};
        		console.log("latLng",latLng);
        	 dataMap[key].mark = dataMap[key].dmap.markMove(map,latLng,'',icons);	
        	}

        dataMap[key] = d4;
       // dataMap[key].dmap.mark(map,{lat:19.5771,lng:74.2080});
       var d = [{lat:d4.last_location.lat,lng:d4.last_location.long},{lat:d4.sec_last_location.lat,lng:d4.sec_last_location.long}];
    console.log("latLng_path",d);
     	dataMap[key].dmap.play(map, dataMap[key].mark, icons, d);
      //dataMap[key].poly.setMap(map);

         
        //console.log("all",dataMap,d4);
        }
  
	     })	    
	    // _io.emit('stat',data[i],new Date().setHours(0,0,0,0),null)
    	// _io.on(data[i]+'stat',function(a1,a2,a3,a4){
    	// 	console.log("start=",a1,a2,a3,a4);
    		
    	// })
  	}


	map = dmap.map('map',{lat:19.5771,lng:74.2080},5);
	
			console.log('dataMap=',dataMap);
	
})
</script>	
</head>
<body>
	<div id="map" style="width:900px;height:700px"></div>
</body>
</html>

